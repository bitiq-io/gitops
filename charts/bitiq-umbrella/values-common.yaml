env: local
baseDomain: apps-crc.testing
appNamespace: bitiq-local
gitopsNamespace: openshift-gitops

# Argo CD controller service account name (default instance)
# If you customize the Argo CD instance name, update this accordingly.
argocdControllerServiceAccount: openshift-gitops-argocd-application-controller
pipelinesNamespace: openshift-pipelines

# Repo & revision for all child Applications
repoUrl: https://github.com/bitiq-io/gitops.git
targetRevision: main

# Image Updater defaults (platform filter)
imageUpdater:
  # Set to the node architecture of your cluster
  # Common values: linux/amd64 (default CRC on x86_64), linux/arm64 (Apple Silicon)
  platforms: linux/amd64
  # Optional: registry auth secret for tag discovery (format: "<ns>/<secret>" or just name in openshift-gitops)
  pullSecret: ""
  toyService:
    enabled: true
    # Image Updater enabled; platform filter stays on amd64 until multi-arch images are available.
    pause: false
  toyWeb:
    pause: false
  nostrThreads:
    enabled: true
    pause: false
  nostouch:
    enabled: true
    pause: false

# Vault operators integration (disabled by default until migration completes)
vault:
  runtime:
    enabled: false
    address: ""
    kubernetesMount: "kubernetes"
    roleName: ""
  config:
    enabled: false
    address: ""
    kubernetesHost: "https://kubernetes.default.svc"
    mountPath: "kubernetes"
    connectionRole: "kube-auth"
    roleName: ""
    policyName: ""

# Sample app images (Image Updater watches these)
# Use Quay for easier public tag discovery in local e2e
sampleAppImages:
  toyService: quay.io/paulcapestany/toy-service
  toyWeb: quay.io/paulcapestany/toy-web
  nostrThreads: quay.io/paulcapestany/nostr_threads
  nostouch: quay.io/paulcapestany/nostouch

# New services (env toggles)
strfry:
  enabled: false
couchbase:
  enabled: false
nostrQuery:
  enabled: false
nostrThreads:
  enabled: false
nostrThreadCopier:
  enabled: false
nostouch:
  enabled: false

ollama:
  enabled: false
  mode: disabled

couchbaseOperator:
  enabled: false

certManager:
  enabled: false
  route53CredentialsEnabled: false
  route53CredentialsPath: cert-manager/route53
  route53SecretName: route53-credentials
  route53SecretNamespace: cert-manager

nostrSite:
  enabled: false

nginxSites:
  enabled: false

bootstrapOperators:
  enabled: false
  # Couchbase Autonomous Operator overrides (passed into bootstrap-operators)
  caoEnabled: false
  caoChannel: ""
  caoName: ""
  caoSource: ""
  caoSourceNamespace: openshift-marketplace
  caoInstallNamespace: openshift-operators
  caoStartingCSV: ""
  caoApproval: Automatic

ciPipelines:
  serviceAccountName: pipeline
  # CRC/OpenShift assigns supplemental groups per namespace. Using the namespace's
  # configured range (see `oc get project openshift-pipelines -o jsonpath='{.metadata.annotations.openshift\.io/sa\.scc\.supplemental-groups}'`)
  # keeps PVC mounts writable for the non-root Tekton pods.
  fsGroup: 1000690000
  eventListener:
    name: bitiq-listener
    githubSecretName: github-webhook-secret
    route: true
    # Debug logging for EventListener (disabled by default; Tekton webhook blocks some env overlays)
    debugLogging: false
  pipelines:
    - name: bitiq-build-and-push
      gitUrl: https://github.com/PaulCapestany/toy-service.git
      gitRevision: main
      dockerfile: Dockerfile
      contextDir: .
      imageRegistry: quay.io
      imageNamespace: paulcapestany
      imageName: toy-service
      tlsVerify: "true"
      # Accept either personal or org repo full name
      repoFullNames:
        - PaulCapestany/toy-service
        - bitiq-io/toy-service
      runTests: "true"
      testImage: registry.access.redhat.com/ubi9/go-toolset:1.24.6
      testScript: |
        go test ./...
      eventTypes: ["push"]
    - name: nostr-threads-build-and-push
      gitUrl: https://github.com/PaulCapestany/nostr_threads.git
      gitRevision: main
      dockerfile: Dockerfile
      contextDir: .
      imageRegistry: quay.io
      imageNamespace: paulcapestany
      imageName: nostr_threads
      tlsVerify: "true"
      repoFullNames:
        - PaulCapestany/nostr_threads
        - bitiq-io/nostr_threads
      runTests: "true"
      testImage: registry.access.redhat.com/ubi9/go-toolset:1.24.6
      testScript: |
        go test ./...
      eventTypes: ["push"]
    - name: nostouch-build-and-push
      gitUrl: https://github.com/PaulCapestany/nostouch.git
      gitRevision: main
      dockerfile: Dockerfile
      contextDir: .
      imageRegistry: quay.io
      imageNamespace: paulcapestany
      imageName: nostouch
      tlsVerify: "true"
      repoFullNames:
        - PaulCapestany/nostouch
        - bitiq-io/nostouch
      runTests: "true"
      testImage: registry.access.redhat.com/ubi9/go-toolset:1.24.6
      testScript: |
        go test ./...
      eventTypes: ["push"]
    - name: bitiq-web-build-and-push
      gitUrl: https://github.com/PaulCapestany/toy-web.git
      gitRevision: main
      dockerfile: Dockerfile
      contextDir: .
      imageRegistry: quay.io
      imageNamespace: paulcapestany
      imageName: toy-web
      tlsVerify: "true"
      repoFullNames:
        - PaulCapestany/toy-web
        - bitiq-io/toy-web
      runTests: "true"
      testImage: registry.access.redhat.com/ubi9/nodejs-20:1-1758500456
      testScript: |
        if [ -f package-lock.json ]; then
          npm ci
        else
          npm install
        fi
        if ! npm ls jest-environment-jsdom >/dev/null 2>&1; then
          npm install --save-dev jest-environment-jsdom@^29
        fi
        if [ -f jest.config.js ]; then
          npm pkg set scripts.test="jest --config=jest.config.js --watch=false"
        else
          npm pkg set scripts.test="jest --watch=false"
        fi
        npm test
      eventTypes: ["push"]
