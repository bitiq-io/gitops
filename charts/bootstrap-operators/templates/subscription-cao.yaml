{{- $op := .Values.operators.cao | default dict -}}
{{- $enabled := (and (hasKey $op "enabled") (eq (lower (printf "%v" (get $op "enabled"))) "true")) -}}
{{- if $enabled }}
{{- if and (get $op "name") (get $op "source") }}
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: {{ $op.name }}
  namespace: {{ $op.installNamespace | default "openshift-operators" }}
spec:
  channel: {{ $op.channel | quote }}
  name: {{ $op.name | quote }}
  source: {{ $op.source | quote }}
  sourceNamespace: {{ $op.sourceNamespace | default "openshift-marketplace" | quote }}
  installPlanApproval: {{ $op.approval | default "Automatic" | quote }}
  {{- if $op.startingCSV }}
  startingCSV: {{ $op.startingCSV | quote }}
  {{- end }}
{{- end }}
{{- end }}

