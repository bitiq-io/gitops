{{- if .Values.enabled }}
{{- $svc := .Values.secrets.toyServiceConfig -}}
{{- if $svc.enabled }}
---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: {{ $svc.destinationName }}
  namespace: {{ $svc.namespace }}
spec:
  mount: kv
  type: kv-v2
  path: {{ $svc.path }}
  destination:
    create: true
    overwrite: true
    name: {{ $svc.destinationName }}
  vaultAuthRef: k8s
  {{- if and $svc.restartTargets $svc.restartTargets.enabled $svc.restartTargets.items }}
  rolloutRestartTargets:
  {{- range $t := $svc.restartTargets.items }}
    - kind: {{ $t.kind }}
      name: {{ $t.name }}
  {{- end }}
  {{- end }}
{{- end }}

{{- $web := .Values.secrets.toyWebConfig -}}
{{- if $web.enabled }}
---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: {{ $web.destinationName }}
  namespace: {{ $web.namespace }}
spec:
  mount: kv
  type: kv-v2
  path: {{ $web.path }}
  destination:
    create: true
    overwrite: true
    name: {{ $web.destinationName }}
  vaultAuthRef: k8s
{{- end }}
{{- end }}
