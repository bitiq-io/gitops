{{- if .Values.enabled }}
{{- $mount := .Values.vault.kubernetesMount | default "kubernetes" -}}
{{- $role := .Values.vault.roleName | default "gitops-local" -}}
{{- $addr := .Values.vault.address -}}

{{- $argocd := .Values.secrets.argocdImageUpdater -}}
{{- if $argocd.enabled }}
---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: {{ $argocd.destinationName }}
  namespace: {{ .Values.namespaces.gitops }}
spec:
  mount: gitops
  type: kv-v2
  path: {{ $argocd.path }}
  destination:
    create: true
    overwrite: true
    name: {{ $argocd.destinationName }}
    type: {{ $argocd.type | default "Opaque" }}
  vaultAuthRef: k8s
{{- end }}

{{- $quay := .Values.secrets.quayAuth -}}
{{- if $quay.enabled }}
---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: {{ $quay.destinationName }}
  namespace: {{ .Values.namespaces.pipelines }}
spec:
  mount: gitops
  type: kv-v2
  path: {{ $quay.path }}
  destination:
    create: true
    overwrite: true
    name: {{ $quay.destinationName }}
    type: {{ $quay.type | default "Opaque" }}
{{- if or $quay.destinationAnnotations $quay.destinationLabels }}
    metadata:
{{- if $quay.destinationAnnotations }}
      annotations:
{{ toYaml $quay.destinationAnnotations | indent 8 }}
{{- end }}
{{- if $quay.destinationLabels }}
      labels:
{{ toYaml $quay.destinationLabels | indent 8 }}
{{- end }}
{{- end }}
  vaultAuthRef: k8s
{{- end }}

{{- $repo := .Values.secrets.gitRepoCreds -}}
{{- if $repo.enabled }}
---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: {{ $repo.destinationName }}
  namespace: {{ .Values.namespaces.gitops }}
spec:
  mount: gitops
  type: kv-v2
  path: {{ $repo.path }}
  destination:
    create: true
    overwrite: true
    name: {{ $repo.destinationName }}
    type: {{ $repo.type | default "Opaque" }}
{{- if or $repo.destinationAnnotations $repo.destinationLabels }}
    metadata:
{{- if $repo.destinationAnnotations }}
      annotations:
{{ toYaml $repo.destinationAnnotations | indent 8 }}
{{- end }}
{{- if $repo.destinationLabels }}
      labels:
{{ toYaml $repo.destinationLabels | indent 8 }}
{{- end }}
{{- end }}
  vaultAuthRef: k8s
{{- end }}

{{- $gh := .Values.secrets.githubWebhook -}}
{{- if $gh.enabled }}
---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: {{ $gh.destinationName }}
  namespace: {{ .Values.namespaces.pipelines }}
spec:
  mount: gitops
  type: kv-v2
  path: {{ $gh.path }}
  destination:
    create: true
    overwrite: true
    name: {{ $gh.destinationName }}
    type: {{ $gh.type | default "Opaque" }}
  vaultAuthRef: k8s
{{- end }}
{{- end }}
